<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Master Panel</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" referrerpolicy="no-referrer"></script>
<script src="//cdn.ckeditor.com/4.20.0/standard/ckeditor.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@editorjs/editorjs@latest"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.min.js" integrity="sha384-QJHtvGhmr9XOIpI6YVutG+2QOK9T+ZnN4kzFN1RtK3zEFEIsxhlmWl5/YESvpZ13" crossorigin="anonymous"></script>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
<!-- <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script> -->
<script src="https://code.jquery.com/jquery-1.12.4.min.js"></script>


<link rel="stylesheet" type="text/css" href="CssPage1.css">
    <script type = "text/javascript" src="jQuery.js"></script>

<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css" integrity="sha512-KfkfwYDsLkIlwQp6LFnl8zNdLGxu9YAA1QvwINks4PhcElQSvqcyVLLD9aMhXd13uQjoXtEKNosOWaZqXgel0g==" crossorigin="anonymous" referrerpolicy="no-referrer" />
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto|Varela+Round|Open+Sans">
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"></script>
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">  
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />





<link href=
"https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.min.css"
         rel="stylesheet">
         <!-- <link rel="stylesheet" href="http://netdna.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css"> -->

<!-- <script src="https://cdn.datatables.net/1.12.1/css/dataTables.bootstrap5.min.css"></script> -->
<!-- <script src="https://cdn.datatables.net/1.12.1/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/1.12.1/js/dataTables.bootstrap5.min.js"></script>
<script src="https://cdn.datatables.net/1.12.1/js/jquery.dataTables.min.js"></script> -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/js/bootstrap.min.js"></script>
<script src="src/fancyTable.js"></script>

<script type="text/javascript" src="/public/pagesort.js"></script>


<link href="https://unpkg.com/bootstrap-table@1.21.0/dist/bootstrap-table.min.css" rel="stylesheet">
<script src="https://unpkg.com/bootstrap-table@1.21.0/dist/bootstrap-table.min.js"></script>
<script src="https://cdn.jsdelivr.net/n pm/jquery.fancytable/dist/fancyTable.min.js"></script> 
<script src="src/fancyTable.js"></script>

  </head>
  <body style="color: white !important;">
    <!-- code for the master page -->
    <div id="wrapper" class="toggled">
      <div id="sidebar-wrapper">
        <div class="logo">
          <img src="logoimage.png" class="logoimg" alt="">
        </div>
          <ul class="sidebar-nav">
             <li>
                <button style="text-align: left; background-color:transparent;border: none; color: white;" onclick="location.href = 'Certification.html'" id="defaultOpen">Certification</button>
              </li>
              <li>
                <button style="text-align: left; background-color:transparent;border: none; margin-top: 20px; color: white;"  onclick="location.href = 'JobTypes.html'" id="defaultOpen">JobTypes</button>
              </li>
              <li>
                <button style="text-align: left; background-color:transparent;border: none;color: white;margin-top: 20px;" onclick="location.href = 'Qualification.html'" id="defaultOpen2">Qualification</button>
              </li>
              <li>
                <button style="text-align: left; background-color:transparent;border: none;color: white;margin-top: 20px;" onclick="location.href = 'Skills.html'" id="defaultOpen3">Skills</button>
              </li>
              <li>
                <button style="text-align: left; background-color:transparent;border: none;color: white;margin-top: 20px;" onclick="location.href = 'FunctionalArea.html'" id="defaultOpen4">Functional Area</button>
              </li>
              <li>
                <button style="text-align: left; background-color:transparent;border: none;color: white;margin-top: 20px;" onclick="location.href = 'Cities.html'" id="defaultOpen5">Cities</button>
              </li>
              <li>
                <button style="text-align: left; background-color:transparent;border: none;color: white;margin-top: 20px;" onclick="location.href = 'Specialization.html'" id="defaultOpen6">Specialization</button>
              </li>
              <li>
                <button class="dropbtn" style="text-align: left; background-color:transparent;border: none;color: white;margin-top: 20px;" onclick="openMaster(event, 'blog')" id="defaultOpen7">Blog Master</button>
              </li>
              <li>
                <button style="text-align: left; background-color:transparent;border: none;color: white;margin-top: 20px;" onclick="location.href = 'PackageMaster.html'" id="defaultOpen8">Package Master</button>
              </li>
              
          </ul>
      </div>

 
 
      <div id="blog" class="tabcontent">
        <a href="#menu-toggle6" style="background-color: #454d55;"  class="tgl-btn" id="menu-toggle6"><i style="color: white; border-top-left-radius:0px" class="fa fa-bars"></i></a>
        <button type="button" style="color: white;" class="btn add-btn" onclick="Logoutfunc()"><i class="fa fa-power-off"></i></button>
        
        <div id="page-content-wrapper">
        <!-- <div class="header"> -->
          <h1>Blog Master</h1>
          <div class="row">
            <div class="col-md-8">
              <div class="bg-t">
                <h4 id="texthead" style="font-size: 2rem;" class="p-2 px-3"> Title </h4>
                <input type="text" contenteditable="true" id="textboc" class="mx-3 m-3">
              </div>
            </div>
    
            <div class="col-md-4">
              <button class="dropbtn1" style="font-size: 2rem;background-color:black;border: none;color: white;text-align:center;" onclick="location.href = 'BlogMasterList.html'">Blog List</button>
            </div>
          </div>
        <!-- </div> -->
        
        <div class="row">
          <div class="col-md-8">
            <div class="card p-0">
              <div class="card-title crd-t">
                <h4 style="font-size: 2rem;" class="p-2 px-3">Description</h4>
              </div>
              <form method="post">
                <textarea class="ckeditor" id="editor" name="content" style="color: black;" rows="10" cols="80" ></textarea>
            </form> 
        </div>
          </div>
          <div class="col-md-4">
            <div class="card height1 p-0">
                <table class="thisis border-0" >
                    <div class="card-title crd-t">
                      <h3 style="font-size: 2rem;" class="p-2 px-3">Employer  Name</h3>
                    </div>
                    <thead>
                        <tbody id="empname" style=" background-color: black; margin-top: 100px;"></tbody>
                    </thead>
                </table>
    
            </div>
            <div class="col-md-4">
              <!-- <button class="dropbtn1" style="background-color:black;border: none;color: white;text-align:center;" onclick="openMaster(event, 'blogtable')">Blog List</button> -->
            </div>
          </div>
        
        </div>
        
        
        <div class="footer">
            <div class="Button">
                <button type="submit" id="subbut" onclick="myFunction1()" class="sub-btn">Submit</button>
                <input id="cancelButton" style="background-color: white; color:black;" class="sub-btn" onClick="window.location.reload();" type="button" value="Cancel">
            </div>
        </div>
        
      </div>
    
    </div>
<script type="module">
    
    // import EditorJS from '@editorjs/editorjs';
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.0.0/firebase-app.js";
      import { getAnalytics } from "https://www.gstatic.com/firebasejs/9.0.0/firebase-analytics.js";
      import { getFirestore } from "https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore.js";
      import { doc, deleteDoc,setDoc, getDoc, getDocs, collection, query, orderBy, limit , where} from "https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore.js";
  
      const firebaseConfig = {
    apiKey: "AIzaSyAADC0o-0zy-R8WWzSY4hq_ckhLzNv6CHM",
    authDomain: "hobyjoby-8b9ca.firebaseapp.com",
    projectId: "hobyjoby-8b9ca",
    storageBucket: "hobyjoby-8b9ca.appspot.com",
    messagingSenderId: "755782612092",
    appId: "1:755782612092:web:98ed2fb25735eb435985f9",
    measurementId: "G-L23JY97GH8"
  };
      
        const app = initializeApp(firebaseConfig);
        const analytics = getAnalytics(app);
        const db = getFirestore(app);
  
        
  
        var today = new Date();
    
        var date = (today.getMonth()+1)  +'/'+today.getDate()+'/'+today.getFullYear() + ',';
        
        var time = today.getHours() + ":" + today.getMinutes() + ":" + today.getSeconds();
        
        var dateTime = date+' '+time;
    
        var tbody= document.getElementById("empname");

        var queryString = window.location.search.substring(1);
        var varArray = queryString.split("="); //eg. index.html?msg=1
        var param = varArray[1];

        $( window ).on("load", async function() {
      

                var cert=[];
                var q1 =  query(collection(db, "BlogMaster"),where("id", "==",param ),limit(1));
                var querySnapshot1 = await getDocs(q1);
                querySnapshot1.forEach((doc) => {
                // doc.data() is never undefined for query doc snapshots
                    cert.push(doc.data());
                });

                cert.forEach(element => {
                    document.getElementById("textboc").value = element.Title;
                    CKEDITOR.instances.editor.setData(element.Description);
                });
                //document.getElementById("textboc").value = title;
           
        });
    
        
        var employerID;
        var cert=[];
        var q1 =  query(collection(db, "BlogMaster"),where("id", "==",param ),limit(1));
        var querySnapshot1 = await getDocs(q1);
        querySnapshot1.forEach((doc) => {
        // doc.data() is never undefined for query doc snapshots
            cert.push(doc.data());
        });

        cert.forEach(element => {
            employerID = element.EmployerId;
        });

        async function AddItemToTable(cat,cby,uat){
    
          
            let trow=document.createElement("tr");
            let td1=document.createElement("td");
            let td2 = document.createElement("td");
            var tio = String(uat);
            
            td1.innerHTML= cat + " " + cby;
            var x = document.createElement("INPUT");
            x.setAttribute("type", "checkbox");
            x.setAttribute("id", "city");
            x.setAttribute("name", "info");
            x.setAttribute("value", tio);

            if(tio.trim() == employerID.trim()){
                x.setAttribute("checked",true);
            }
            td2.appendChild(x);
    
            trow.appendChild(td1);
            trow.appendChild(td2);
            tbody.appendChild(trow);
                
        }

    
        window.myFunction1 =  async function (){
  
  
          var type =  CKEDITOR.instances.editor.getData();
          var content = removeTags(type);
         
          //alert(content);
         // var img = document.getElementById("imgsrc1");
          // alert(img);    
          var dbID;
          var q1 =  query(collection(db, "BlogMaster"),orderBy("id", "desc"),limit(1));
          var querySnapshot1 = await getDocs(q1);
          querySnapshot1.forEach((doc) => {
             // doc.data() is never undefined for query doc snapshots
             dbID = parseInt(doc.id)+1;
          });
          var num = dbID.toString();;
  
          var head = document.getElementById("textboc").value;
  
                    var checkboxes = document.getElementById("city").value;
                    $(document).ready(function() {
                            var arr = [];
                            $.each($("input[name='info']:checked"), function(){
                                arr.push($(this).val());
                                // alert($(this).val());
                                var stringmas = String($(this).val());
                                setDoc(doc(db, "BlogMaster", num), {
                                    Description: content,
                                    Title: head,
                                    EmployerId: stringmas,
                                    CreatedAt: dateTime,
                                    CreatedBy:"1" ,
                                    UpdatedAt: dateTime,
                                    UpdatedBy: "1",
                                    id: num,
                                })
                                .then(()=> {  
                                  setTimeout("location.href = 'BlogMasterList.html'",120);
                                })     
                                .catch((error)=>{
                                    console.log(error);
                                }); 
        
                            });
                    });
        }
    
    
        window.removeTags = function(str){
        if ((str===null) || (str===''))
            return false;
        else
            str = str.toString();
              
        // Regular expression to identify HTML tags in 
        // the input string. Replacing the identified 
        // HTML tag with a null string.
        return str.replace( /(<([^>]+)>)/ig, '');
    }
    
        function AddAllItemsToTable(certification){
            tbody.innerHTML="";
    
            certification.forEach(element => {
            AddItemToTable(element.FirstName,element.LastName,element.UserID);    
            });
    
        }
    var cert=[];
    var querySnapshot = await getDocs(collection(db, "EmployerMaster"));
    querySnapshot.forEach((doc) => {
        cert.push(doc.data());
       // console.log(doc.data());
      AddAllItemsToTable(cert);
    
    });
    
    window.Logoutfunc = function(){
      window.location.replace("index.html");
    }
                                                                 
    </script>
  
    </body>
  </html>
  